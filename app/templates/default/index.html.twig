{% extends 'base.html.twig' %}

{% block title %}Home
{% endblock %}

{% block body %}
	{% if hall_of_fame %}
		{% if not app.user %}
			{% include('./header.html.twig') with {'poster_picture_id':  (hall_of_fame|first).id} %}
		{% else %}
			{% include('./header.html.twig') with {'poster_picture_id': (hall_of_fame|first).id, 'username': app.user.name} %}
		{% endif %}
	{% else %}
		{% if not app.user %}
			{% include('./header.html.twig') %}
		{% else %}
			{% include('./header.html.twig') with {'username': app.user.name} %}
		{% endif %}
	{% endif %}
	<div class="sm:py-10 min-[1850px]:px-64 2xl:px-32 sm:px-4  m-2">
		<div class="flex">
			<a href="#feed" class="text-white">
				See your feed</a>&emsp;
			{{ "now"|date("j F") }}
		</div>
		{% include ('./_hallOfFame.twig') with {'hall_of_fame': hall_of_fame} %}
		<hr class="py-2 ">
		<div class="scrollable">
			<div class="flex place-content-between">
				<p class="text-xl">You've recently followed them
				</p>
				<a class="rounded text-white cursor-pointer p-2" href="{{ path('app_series_show_followed') }}">See more</a>
			</div>

			<ul class="flex gap-6 pb-10 xl:place-content-around xl:overflow-hidden overflow-y-hidden overflow-x-auto  flex-shrink-0">
				{% for serie in recently_seen|slice(0, 5)  %}
					<div class="flex relative group gap-0 items-center w-96">
						<a href="{{ path('app_series_show', {'id': serie.id}) }}" class="w-48 h-full">
							<img src="{{ path('app_series_poster', {'id': serie.id}) }}" alt="Series poster" class=" w-full h-full object-cover">
						</a>
						{% include('./follow.html.twig') with {'series': serie} %}
					</div>
				{% endfor %}
			</ul>
		</div>
		<hr class="py-2 ">
		<div class="scrollable" id="feed">
			<div class="flex place-content-between mb-2">
				<p class="text-2xl text-white">Feed</p>
			</div>

			<ul class="flex flex-col gap-6 pb-10 xl:place-content-around xl:overflow-hidden overflow-y-hidden overflow-x-auto  flex-shrink-0">
				{% for fe in feed  %}
					<div class="flex relative group gap-0 ">
						<a href="{{ path('app_series_show', {'id': fe.serie_id}) }}" class="w-48 h-full">
							<img src="{{ path('app_series_poster', {'id': fe.serie_id}) }}" alt="Series poster" class=" w-full h-full object-cover">
						</a>
						<div id="{{ fe.user_id }}" class="h-full flex p-4 flex-col gap-2 ">
							<span class="text-white font-bold text-2xl">{{fe.title}}</span>
							<div class="flex flex justify-between">
								<div class="flex gap-2 ">
									<a class="text-white" href="{{path('app_user_show', {'id': fe.user_id })}}">{{fe.user_name}}</a>
									<p class="text-[--grey] font-bold">{{ fe.date|ago }}
										{# if date i further than 1 week show real date #}
										{% set timeDifference = ("now"|date("U") - fe.date|date("U")) %}
										{% if timeDifference > 60*60*24*7 %}
											<span>{{ fe.date|date("d/m/y") }}</span>
										{% endif %}
									</p>
								</div>
							</div>
							<div class="flex gap-1 relative items-center">
								{% include('./_stars.html.twig') with {'rating': fe.value/2} %}
							</div>
							<div class="text-lg text-[--white] italic">
								<p style="overflow-wrap: anywhere">{{ fe.comment }}</p>
							</div>
						</div>
					</div>
				{% endfor %}
			</ul>
		</div>
	</div>
	<style></style>
{% endblock %}
